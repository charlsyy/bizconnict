{% extends "base.html" %}
{% block title %}Order #{{ order.id }} — BizConnect{% endblock %}
{% block content %}
<div class="page page-sm">
  <span class="label">Order Tracking</span>
  <h1 class="mt-1 mb-2">Order #{{ order.id }}</h1>
  <p class="text-muted text-sm mb-5">Placed on {{ order.created_at|date:"F d, Y" }}</p>

  <div class="panel mb-5">
    <div class="flex-between mb-4">
      <div>
        <div class="text-sm text-muted">Status</div>
        <span class="badge {% if order.status == 'delivered' %}badge-success{% elif order.status == 'cancelled' %}badge-danger{% else %}badge-warning{% endif %}" style="font-size:13px;padding:5px 14px;margin-top:4px;">
          {{ order.get_status_display }}
        </span>
      </div>
      <div class="text-right">
        <div class="text-sm text-muted">Total</div>
        <div style="font-family:var(--font-display);font-size:1.4rem;font-weight:700;color:var(--gold-dark);">
          ₱{{ order.total_amount|floatformat:2 }}
        </div>
      </div>
    </div>
    {% if order.shipping_address %}
    <div class="text-sm">
      <span class="text-muted">Ship to:</span> {{ order.shipping_address }}
    </div>
    {% endif %}
  </div>

  <div class="panel mb-5">
    <h3 class="mb-4">Order Timeline</h3>
    {% with steps="pending,accepted,packed,shipped,delivered" %}
    <div class="timeline">
      {% for log in logs %}
      <div class="timeline-item">
        <div class="timeline-dot {% if forloop.last %}active{% else %}done{% endif %}"></div>
        <div class="timeline-label">{{ log.get_status_display }}</div>
        <div class="timeline-date">{{ log.created_at|date:"M d, Y H:i" }}</div>
        {% if log.note %}<div class="text-sm text-muted mt-1">{{ log.note }}</div>{% endif %}
      </div>
      {% empty %}
      <p class="text-muted">No status updates yet.</p>
      {% endfor %}
    </div>
    {% endwith %}
  </div>

  <div class="panel">
    <h3 class="mb-4">Items Ordered</h3>
    <div class="table-wrap">
      <table>
        <thead><tr><th>Product</th><th>Qty</th><th>Unit Price</th><th>Subtotal</th></tr></thead>
        <tbody>
          {% for item in order.items.all %}
          <tr>
            <td>{{ item.product_name }}</td>
            <td>{{ item.quantity }}</td>
            <td>₱{{ item.unit_price|floatformat:2 }}</td>
            <td>₱{{ item.subtotal|floatformat:2 }}</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}