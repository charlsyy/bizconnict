{% extends "base.html" %}
{% block title %}Messages â€” BizConnect{% endblock %}

{% block content %}
<div class="page-content">
  <h1 class="page-title">ðŸ’¬ Messages</h1>
  {% if conv_data %}
  <div style="display:flex;flex-direction:column;gap:var(--space-sm);max-width:640px;">
    {% for item in conv_data %}
    <a href="{% url 'chat_room' item.conv.id %}" style="text-decoration:none;">
      <div class="card" style="display:flex;align-items:center;gap:var(--space-md);padding:var(--space-md);">
        <div style="width:48px;height:48px;background:var(--primary);border-radius:50%;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:18px;flex-shrink:0;">
          {{ item.other.username|first|upper }}
        </div>
        <div style="flex:1;min-width:0;">
          <div style="font-weight:700;color:var(--text);">{{ item.other.username }}</div>
          <div style="font-size:var(--font-size-sm);color:var(--text-muted);">
            {% with last=item.conv.messages.last %}
              {% if last %}{{ last.body|truncatechars:50 }}{% else %}No messages yet{% endif %}
            {% endwith %}
          </div>
        </div>
        {% if item.unread > 0 %}
        <span class="badge">{{ item.unread }}</span>
        {% endif %}
      </div>
    </a>
    {% endfor %}
  </div>
  {% else %}
  <div style="text-align:center;padding:var(--space-2xl);color:var(--text-muted);">
    No conversations yet. Browse the <a href="{% url 'product_list' %}">marketplace</a> and chat with sellers.
  </div>
  {% endif %}
</div>
{% endblock %}